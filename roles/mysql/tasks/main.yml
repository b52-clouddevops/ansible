- name: Coping MySql Repo  
  ansible.builtin.copy:                    # Copies the file from the files directory
    src: "{{COMPONENT}}.repo"
    dest: /etc/yum.repos.d/{{COMPONENT}}.repo 

- name: Installing MySql 
  ansible.builtin.yum:
    name: 
       - mysql-community-server
       - MySQL-python
    state: present  

- name: Starting MySQL service 
  ansible.builtin.service:
    name: mysqld
    state: started
    enabled: true  

- name: Collect all info except settings and users by root
  community.mysql.mysql_info:
    login_user: root
    login_password: RoboShop@1
  ignore_errors: yes  
  register: MYSQL_STAT



- name: Fetching Default Password 
  when: MYSQL_STAT.failed                  # This task will be executed only when the status of failed is TRUE 
  ansible.buildin.shell: grep "temporary password" /var/log/mysqld.log | awk '{print $NF}' 
  register: DEFAULT_ROOT_PASSWORD  

- name: Coping MySql Repo  
  ansible.builtin.copy:                    # Copies the file from the files directory
    src: root-pass.sql
    dest: /tmp/root-pass.sql 
  when: MYSQL_STAT.failed  

- name: Reset Default Password 
  when: MYSQL_STAT.failed                  # This task will be executed only when the status of failed is TRUE 
  ansible.buildin.shell: mysql --connect-expired-password -uroot -p"{{DEFAULT_ROOT_PASSWORD}}" < /tmp/root-pass.sql 
  register: DEFAULT_ROOT_PASSWORD  